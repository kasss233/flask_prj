{% extends "base.html" %}

{% block content %}
    <h1>æ–‡ä»¶ç®¡ç†å™¨</h1>

    <div class="current-path">å½“å‰è·¯å¾„: <strong>/{{ current_dir_display }}</strong></div>

    {% if current_dir_normalized != "" %}
      <a href="{{ url_for('main.manage_files', path=parent_dir) }}" class="parent-link">â¬†ï¸ è¿”å›ä¸Šä¸€çº§ ({{ parent_dir_display }})</a>
    {% endif %}

    <h2>ç›®å½•å’Œæ–‡ä»¶</h2>
    <ul>
      {% for item in items %}
        {% if item.is_dir %}
          <li class="dir">
            <span><span class="item-icon">ğŸ“</span><a href="{{ url_for('main.manage_files', path=item.path) }}">{{ item.name }}</a></span>
            <span class="actions">
              <a href="{{ url_for('main.delete_item', item_path=item.path) }}" class="delete" onclick="return confirm('ç¡®å®šè¦åˆ é™¤ç›®å½• \\'{{ item.name }}\\' å—ï¼Ÿè¿™å°†åˆ é™¤å…¶ä¸‹æ‰€æœ‰å†…å®¹ï¼');">åˆ é™¤</a>
            </span>
          </li>
        {% else %}
          <li class="file">
            <span><span class="item-icon">ğŸ“„</span>{{ item.name }}</span>
            <span class="actions">
              <a href="{{ url_for('main.download_file_route', file_path=item.path) }}" class="download">ä¸‹è½½</a>
              <a href="{{ url_for('main.delete_item', item_path=item.path) }}" class="delete" onclick="return confirm('ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ \\'{{ item.name }}\\' å—ï¼Ÿ');">åˆ é™¤</a>
            </span>
          </li>
        {% endif %}
      {% endfor %}
      {% if not items %}
        <li>å½“å‰ç›®å½•ä¸ºç©ºã€‚</li>
      {% endif %}
    </ul>

    <div class="form-group">
      <h2>ä¸Šä¼ æ–‡ä»¶åˆ°å½“å‰ç›®å½•</h2>
      <form method="post" action="{{ url_for('main.upload_file', current_path_segment=current_dir_normalized) }}" enctype="multipart/form-data">
        <input type="file" name="file" required>
        <button type="submit">ä¸Šä¼ </button>
      </form>
    </div>

    <div class="form-group">
      <h2>åœ¨å½“å‰ç›®å½•åˆ›å»ºæ–°æ–‡ä»¶å¤¹</h2>
      <form method="post" action="{{ url_for('main.create_folder_route', current_path_segment=current_dir_normalized) }}">
        <input type="text" name="folder_name" placeholder="æ–‡ä»¶å¤¹åç§°" required pattern="[^\\/:\x22*?<>|]+" title="æ–‡ä»¶å¤¹åç§°ä¸èƒ½åŒ…å« \\ / : * ? &quot; < > | ç­‰å­—ç¬¦">
        <button type="submit">åˆ›å»º</button>
      </form>
    </div>
{% endblock %}
